"0",""
"0","# Join the three tables on relevant keys"
"0","joined_data <- ecotox.tests %>%"
"0","  filter(test_cas %in% search_cas) %>% "
"0","  inner_join(ecotox.results, by = ""test_id"") %>%"
"0","  inner_join(ecotox.species_codes, by = ""species_number"") %>% "
"0","  collect()"
"0",""
"0","# # Filter data for genus 'Oncorhynchus' and endpoint 'LC50'"
"0","# filtered_data <- joined_data %>%"
"0","#   filter(genus == ""Oncorhynchus"") %>% "
"0","#   collect() %>% "
"0","# filter("
"0","#   grepl(""LC50"",endpoint)"
"0","# ) %>% mutate(test_cas = test_cas %>% as.numeric())"
"0","# # Get distinct test_cas"
"0","# distinct_test_cas <- filtered_data %>%"
"0","#   dplyr::select(test_cas) %>%"
"0","#   distinct() %>% left_join(ecotox.chemicals %>% collect(),by=join_by(test_cas == cas_number))"
"0",""
"0","sel_effect_codes <- c(""MOR"", ""MORT"", ""GMOR"", ""PSUR"", ""SURV"", "
"0","                  ""SVVS"")"
"0",""
"0","# View or store the result"
"0","candidate_tests <- joined_data %>%"
"0","  filter(effect %in% sel_effect_codes)%>% "
"0","  filter(media_type == ""FW"" | media_type == ""FW/"" ) #filter for freshwater only"
"0","  #inner_join(ecotox_search_chemicals, by = join_by(test_cas == CAS)) "
"0","  "
"0",""
"0",""
"0",""
